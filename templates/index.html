<!DOCTYPE html>
<html lang="en">
<head>
    <title>YOLOv1 Object Detection</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Reset and Base Styles */
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        /* Video and Image Sections */
        .video-section, .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .card {
            margin-top: 30px; /* Gap between Video Section and Image Detection card */
        }

        /* Video Containers */
        .video-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 640px;
            height: 480px;
        }

        .video-container img {
            width: 640px;
            height: 480px;
            object-fit: cover;
            display: block;
        }

        .video-container .placeholder {
            width: 100%;
            height: 100%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container .placeholder i {
            font-size: 5em;
            color: #ccc;
        }

        /* Status Badge */
        .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: bold;
            color: white;
            font-size: 0.9em;
            z-index: 10;
        }

        .status-on {
            background: #4CAF50;
        }

        .status-off {
            background: #f44336;
        }

        /* Controls Section */
        .controls-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .classes-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .classes-group h3 {
            margin-bottom: 15px;
            color: #667eea;
            font-size: 1.3em;
            text-align: center;
        }

        .classes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .class-item {
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid #e0e6ff;
        }

        .camera-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
        }

        .btn-start {
            background: #4CAF50;
            color: white;
        }
        .btn-start:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }
        .btn-start:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-stop {
            background: #f44336;
            color: white;
        }
        .btn-stop:hover:not(:disabled) {
            background: #da190b;
            transform: translateY(-2px);
        }
        .btn-stop:disabled {
            background: #ccc;
            cursor: not-allowed;
        }


        /* =========================
        IMAGE CONTAINER STYLING
        ========================= */
        .image-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 640px;
            height: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #111;
        }

        .image-container img {
            width: 100%;
            height: auto;
            object-fit: contain; /* ✅ full image visible, no cropping */
            border-radius: 15px;
            display: block;
        }

        .image-container .placeholder {
            width: 100%;
            aspect-ratio: 4 / 3; /* maintains shape before upload */
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-container .placeholder i {
            font-size: 5em;
            color: #ccc;
        }

        /* Upload Controls Section */
        .upload-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: 480px; /* Match image container height */
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .upload-controls form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .upload-controls input[type="file"] {
            padding: 10px;
            border: 2px dashed #667eea;
            border-radius: 6px;
            background: #f8f9ff;
            text-align: center;
            width: 85%;
            box-sizing: border-box;
            font-size: 0.9em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-detect {
            background: #ff6b6b;
            padding: 10px 20px;
            font-size: 1em;
            min-width: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-detect:hover {
            background: #e55a5a;
            transform: translateY(-2px);
        }

        .btn-new {
            background: #667eea;
            padding: 8px 16px;
            font-size: 0.95em;
            min-width: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-new:hover {
            background: #5a71d8;
            transform: translateY(-2px);
        }

        /* Project Section */
        .project-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .project-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 2.0em;
            text-align: center;
        }

        .project-info {
            line-height: 1.6;
            color: #555;
            font-size: 0.95em;
        }

        .highlight {
            background: #fff3cd;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #044785;
        }

        .paper-link {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .paper-link:hover {
            transform: translateY(-2px);
            color: white;
        }

        /* Card Header */
        .card-header {
            text-align: center;
            color: white;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.5em;
        }

        /* Card Content */
        .card-content {
            display: grid;
            grid-template-columns: 640px 350px;
            gap: 30px;
            align-items: center; /* Align items vertically centered */
        }

        /* Error Message */
        .error-message {
            color: #f44336;
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
        }

        /* Media Query */
        @media (max-width: 900px) {
            .main-content, .card-content {
                grid-template-columns: 1fr;
            }
            .video-container, .image-container {
                width: 100%;
                height: auto;
                aspect-ratio: 4/3;
            }
            .image-container img, .image-container .placeholder {
                width: 640px;
                height: 480px;
            }
            .video-container img, .image-container img {
                width: 100%;
                height: auto;
            }
            .upload-controls {
                height: auto;
                padding: 15px;
            }
        }

        .section-block img {
            width: 60%;   /* or try 50%, 70% depending on how small you want */
            height: auto;
            display: block;
            margin: 10px auto;
            border-radius: 8px;
            transition: all 0.6s ease;
            transform: translateY(10px);
        }
        .section-block img.loaded {
            opacity: 1;
            transform: translateY(0);
        }



    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-eye"></i> YOLOv1 Detection</h1>
            <p>Real-time Object Detection • 20 Classes • Live Demo</p>
        </div>
        
        <div class="main-content">
            <div class="video-section">
                <div class="video-container">
                    {% if camera_on %}
                        <img src="{{ url_for('video_feed') }}" alt="Live Feed">
                        <div class="status-badge status-on">
                            <i class="fas fa-video"></i> LIVE
                        </div>
                    {% else %}
                        <div style="width:640px;height:480px;background:#f0f0f0;display:flex;align-items:center;justify-content:center;">
                            <i class="fas fa-camera" style="font-size:5em;color:#ccc;"></i>
                        </div>
                        <div class="status-badge status-off">
                            <i class="fas fa-power-off"></i> OFF
                        </div>
                    {% endif %}
                </div>
                
            </div>
            
            <div class="controls-section">
                <div class="classes-group">
                    <h3><i class="fas fa-tags"></i> Detected Classes</h3>
                    <div class="classes-grid">
                        <div class="class-item">👨 Person</div>
                        <div class="class-item">🚗 Car</div>
                        <div class="class-item">🐱 Cat</div>
                        <div class="class-item">🐶 Dog</div>
                        <div class="class-item">🚌 Bus</div>
                        <div class="class-item">🚲 Bicycle</div>
                        <div class="class-item">✈️ Aeroplane</div>
                        <div class="class-item">🚤 Boat</div>
                        <div class="class-item">🐄 Cow</div>
                        <div class="class-item">🐑 Sheep</div>
                        <div class="class-item">🐦 Bird</div>
                        <div class="class-item">🏍️ Motorbike</div>
                        <div class="class-item">🚂 Train</div>
                        <div class="class-item">🛵 Horse</div>
                        <div class="class-item">🪑 Chair</div>
                        <div class="class-item">🛋️ Sofa</div>
                        <div class="class-item">🍽️ Diningtable</div>
                        <div class="class-item">📺 TVmonitor</div>
                        <div class="class-item">🪴 Pottedplant</div>
                        <div class="class-item">🍷 Bottle</div>
                    </div>
                </div>
                
                <form method="POST">
                    <div class="camera-buttons">
                        <button type="submit" name="camera" value="on" class="btn btn-start" 
                                {% if camera_on %}disabled{% endif %}>
                            <i class="fas fa-play"></i> Start Camera
                        </button>
                        <button type="submit" name="camera" value="off" class="btn btn-stop" 
                                {% if not camera_on %}disabled{% endif %}>
                            <i class="fas fa-stop"></i> Stop Camera
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Image Detection Card -->
        <div class="card">
            <h3 class="card-header">
                <i class="fas fa-image"></i> Image Detection
            </h3>
            <div class="card-content">
                <!-- LEFT: IMAGE CONTAINER -->
                <div class="image-container">
                    {% if result_image %}
                        <img id="preview" src="{{ result_image }}" alt="Detected Image">
                        <div class="status-badge status-on">
                            <i class="fas fa-check"></i> DETECTED
                        </div>
                    {% else %}
                        <img id="preview" src="" alt="Preview" style="display:none;">
                        <div class="placeholder" id="placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="status-badge status-off" id="upload-badge">
                            <i class="fas fa-upload"></i> UPLOAD
                        </div>
                    {% endif %}
                </div>

                <!-- RIGHT: UPLOAD CONTROLS -->
                <div class="upload-controls">
                    <form method="POST" action="/" enctype="multipart/form-data">
                        <input type="file" name="file" accept="image/*" required onchange="previewImage(event)">
                        <div class="button-group">
                            <button type="submit" class="btn-detect">
                                <i class="fas fa-magic"></i> Detect
                            </button>
                            {% if result_image %}
                            <button onclick="window.location.href='/'" class="btn-new">
                                <i class="fas fa-redo"></i> New
                            </button>
                            {% endif %}
                        </div>
                    </form>

                    {% if error %}
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i> {{ error }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- My YOLOv1 Project -->               
        <div class="project-section" style="grid-column: 1 / -1;">
            <h3><i class="fas fa-certificate"></i> My YOLOv1 Project</h3>
        
            <!-- TOP BUTTONS -->
            <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 25px;">
                <a href="https://arxiv.org/pdf/1506.02640.pdf" target="_blank" class="paper-link" 
                   style="background: linear-gradient(135deg, #3a7bd5, #3a6073);">
                    <i class="fas fa-file-pdf"></i> YOLOv1 Paper
                </a>
                <a href="https://github.com/ajstyle007" target="_blank" class="paper-link" 
                   style="background: linear-gradient(135deg, #333, #555);">
                    <i class="fab fa-github"></i> GitHub Code
                </a>
            </div>
        
            <div class="project-info">
                <!-- INTRO DETAILS -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 25px;">
                    <!-- LEFT COLUMN -->
                    <div>
                        <p><strong>🎯 What I Built:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: #555;">
                            <li><span class="highlight">ResNet-18 Backbone</span></li>
                            <li><span class="highlight">YOLOv1 Loss Function</span></li>
                            <li><span class="highlight">PASCAL VOC 2007 + 2012</span></li>
                            <li><span class="highlight">XML Annotations</span></li>
                            <li><span class="highlight">15 Hours Training</span></li>
                        </ul>
                    </div>
                    
                    <!-- RIGHT COLUMN -->
                    <div>
                        <p><strong>🛠️ Technical Details:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: #555;">
                            <li><span class="highlight">Adam Optimizer</span></li>
                            <li><span class="highlight">Learning Rate Scheduler</span></li>
                            <li><span class="highlight">Custom Dataset Loader</span></li>
                            <li><span class="highlight">Checkpointing & Logging</span></li>
                            <li><span class="highlight">Checkpointing & Logging</span></li>
                        </ul>
                    </div>
                </div>
        
                <hr style="margin: 25px 0; border: none; height: 2px; background: linear-gradient(90deg, transparent, #667eea, transparent);">
        
                <!-- LOSS FUNCTION SECTION -->
                <div class="section-block" style="margin-bottom: 30px;">
                    <h4><i class="fas fa-equals"></i> YOLOv1 Loss Function</h4>
                    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 15px;">
                        <img src="static/images/loss_func.png" alt="YOLOv1 Loss Function" 
                             style="max-width: 85%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 15px;">
                        <p style="text-align: justify; color: #555; line-height: 1.6;">
                            The YOLOv1 loss function is a combination of localization, confidence, and classification losses. 
                            I replicated this equation from the official paper and implemented it using <strong>MSELoss</strong> with 
                            customized weights — <code>λ_coord = 5</code> and <code>λ_noobj = 0.5</code>. 
                            It penalizes bounding box coordinate errors more heavily while reducing the influence of boxes with no objects.
                        </p>
                    </div>
                </div>

                <hr style="margin: 25px 0; border: none; height: 2px; background: linear-gradient(90deg, transparent, #667eea, transparent);">
        
                <!-- ARCHITECTURE SECTION -->
                <div class="section-block">
                    <h4><i class="fas fa-project-diagram"></i> YOLOv1 Architecture</h4>
                    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 15px;">
                        <img src="static/images/yolo_architechture.png" alt="YOLOv1 Architecture"
                             style="max-width: 85%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 15px;">
                        <p style="text-align: justify; color: #555; line-height: 1.6;">
                            I implemented the YOLOv1 head on top of a <strong>ResNet-18 backbone</strong> 
                            pre-trained on ImageNet. The feature extractor outputs a grid structure 
                            that predicts bounding boxes and class probabilities directly in one forward pass. 
                            This enables real-time object detection without the need for region proposals.
                        </p>
                    </div>
                </div>
        
                <hr style="margin: 25px 0; border: none; height: 2px; background: linear-gradient(90deg, transparent, #667eea, transparent);">
        
                <!-- DEVELOPMENT STORY -->
                <p><strong>📝 Development Journey:</strong></p>
                
                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 15px;">
                    This project was a <strong>great learning journey</strong> for me. 
                    I learned how to read and understand a <strong>computer vision research paper</strong> 
                    and implement it from the ground up — line by line.  
                    I <strong>mathematically derived the loss functions</strong> myself and implemented them 
                    using the <strong>PyTorch framework</strong>, which gave me real experience in 
                    architecture design and debugging.  
                </p>

                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 10px;">
                    I initially built everything from scratch, including the YOLOv1 class and loss function, 
                    training for over <strong>150 epochs</strong> without success due to poor feature extraction. 
                    Later, I integrated <strong>ResNet-18</strong> as a backbone for feature learning, 
                    leading to stable convergence and significantly improved bounding box predictions. 
                    I also created a custom PASCAL VOC dataset class that parsed XML annotations and 
                    generated training labels in the <code>S×S×(B*5 + C)</code> YOLO format.
                </p>

                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 10px;">
                    While visualizing and testing with mAP and class only testing, I noticed that my model sometimes misses drawing all the bounding boxes for multiple objects in an image, 
                    even though the predicted classes are mostly correct and aligned accurately. 
                    This behavior is expected since I <strong>trained everything from scratch</strong>, 
                    including the architecture and loss design. 
                    I plan to further <strong>improve detection consistency</strong> and optimize the 
                    <strong>bounding box assignment strategy</strong> in future iterations.
                </p>
                
                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 10px;">
                    This project became an important part of my <strong>AI research learning journey</strong>, 
                    where I learned how to <strong>train models for over 50 hours</strong> 
                    with proper <strong>checkpointing and logging</strong>.  
                    Later, I built a complete web application using 
                    <strong>Flask, HTML, CSS, and a bit of JavaScript</strong>.  
                </p>
                
                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 10px;">
                    Before writing any code, I manually studied the YOLO research paper to understand 
                    how the model predicts bounding boxes, assigns class labels, 
                    and draws the final detections.  
                    During this process, I gained hands-on experience working with 
                    the <strong>PASCAL VOC 2007 & 2012 datasets</strong>, which already contained 
                    annotated images in XML format.  
                </p>
                
                <p style="text-align: justify; color: #555; line-height: 1.6; margin-top: 10px;">
                    Although I could have used ready-made models like <strong>YOLOv8</strong> 
                    to build this project, I chose to <strong>implement everything from scratch</strong> 
                    because my main goal was <strong>learning and deep understanding</strong>.  
                </p>
                

            </div>
        </div>
    </div>
</body>
</html>


<script>
    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('preview');
        const placeholder = document.getElementById('placeholder');
        const uploadBadge = document.getElementById('upload-badge');
    
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                if (placeholder) placeholder.style.display = 'none';
                if (uploadBadge) uploadBadge.innerHTML = '<i class="fas fa-eye"></i> PREVIEW';
            };
            reader.readAsDataURL(file);
        } else {
            preview.src = '';
            preview.style.display = 'none';
            if (placeholder) placeholder.style.display = 'flex';
            if (uploadBadge) uploadBadge.innerHTML = '<i class="fas fa-upload"></i> UPLOAD';
        }
    }

    document.querySelectorAll('.section-block img').forEach(img => {
    img.addEventListener('load', () => img.classList.add('loaded'));
    });
</script>
    